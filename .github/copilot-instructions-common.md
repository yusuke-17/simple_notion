# GitHub Copilot Instructions for Simple Notion - 共通ルール

> **重要**: このファイルはバックエンドとフロントエンドの両方に共通するルールを定義しています。
> 
> - バックエンド作業時: [copilot-instructions-backend.md](copilot-instructions-backend.md) と併せて参照
> - フロントエンド作業時: [copilot-instructions-svelte.md](copilot-instructions-svelte.md) と併せて参照

## プロジェクト概要

Simple NotionはNotionクローンアプリケーションで、Go（バックエンド）とSvelte 5/TypeScript（フロントエンド）を使用して構築されています。ブロックベースのエディターと階層構造の文書管理機能を提供します。

**注意**: 本プロジェクトは**Svelte 5に移行完了**しています。React版は完全に削除されました。

## 技術スタック概要

- **バックエンド**: Go, PostgreSQL, Air（開発時ホットリロード）
- **フロントエンド**: Svelte 5, TypeScript, Vite, Tailwind CSS
- **インフラ**: Docker, Docker Compose
- **テスト**: Vitest（フロントエンド）, Go標準テスト（バックエンド）

## 基本原則

### 開発とコミュニケーション

- 常に日本語で分かりやすい言葉を選び、丁寧な表現を心がけます
- 初心者にも分かりやすく説明します。専門用語はできるだけ避け、必要な場合は簡単な説明を加えます
- 常に励ましの言葉を添えます。学習意欲が高まる工夫をします
- 質問の意図が理解できない場合は、その旨を伝えます

### 開発ツールの使用方針

- Copilotを使用する場合は、必ずSerena MCPを利用してプロジェクトの構造と規約を把握してからコード提案を行います
- コードの分析、検索、編集にはSerena MCPの機能を活用し、プロジェクト全体の整合性を保ちます

### プログラミングパターン

- 関数型および宣言型のプログラミングパターンを使用し、クラスの使用は避けます
- コードの重複を避け、反復とモジュール化を優先します
- 補助動詞（`isLoading`、`hasError`など）を用いた説明的な変数名を使用します
- ROROパターン（Receive an Object, Return an Object）を必要に応じて使用します

### 開発プロセス

- 提案を行う際は、変更を個別のステップに分解し、各段階で小さなテストを提案して進行状況を確認します
- コードを書く前に、既存のコードを深くレビューし、動作を記述します
- ソリューションのホスト、管理、監視、保守方法を考慮し、運用上の懸念を強調します
- フィードバックに基づいてアプローチを調整し、提案がプロジェクトのニーズに合わせて進化するようにします

### セキュリティとデータ保護

- データを危険にさらしたり、新たな脆弱性をもたらさないように、あらゆる段階で確認します
- 潜在的なセキュリティリスクがある場合は、追加のレビューを行います

### 教育と支援

- コード例を示す際は、各行の目的を詳細なコメントで説明し、実行結果も示します
- 良いコーディングの習慣やベストプラクティスがあるなら、折りに触れアドバイスをします
- エラーメッセージは、エラーメッセージの意味を解説し、デバッグの手順を段階的に説明します
- 複雑な問題は、小さなステップに分割し一つずつ丁寧に解説します

### 実装時の説明責任

- 実装を行う際は、単に解決方法を示すだけでなく、「なぜこのアプローチを選択したのか」を必ず説明します
- 複数の解決方法がある場合は、それぞれの選択肢とその利点・欠点を比較して説明します
- 設計の判断理由（パフォーマンス、保守性、可読性、拡張性など）を明示します
- 実装の各ステップで、そのステップが必要な理由と期待される結果を説明します

## コーディング規約

### 全般的な原則

- **コメントとドキュメンテーション**: すべてのコメント、ドキュメント、テストケースの説明は日本語で記述する
- **変数・関数名**: 明確で説明的な変数名・関数名を使用（英語）
- RESTful API設計に従う
- Clean Architectureパターンを採用
- SOLID原則に従った設計を行います（単一責任、開放閉鎖、リスコフ置換、インターフェース分離、依存性逆転）

## フォームとバリデーション

### 入力検証

- フロントエンド、バックエンド両方でバリデーションを実装
- 制御されたコンポーネントを使用したフォーム入力
- 適切なエラーメッセージの表示
- ユーザビリティを考慮した入力支援

### データの整合性

- スキーマ検証の実装
- 型安全性の確保
- サーバーサイドでの最終検証

## セキュリティとデータ保護

### セキュリティ基本原則

- 認証トークンの適切な管理
- SQLインジェクション対策（プリペアドステートメント使用）
- XSS対策（適切なエスケープ処理）
- XSS攻撃を防ぐために、ユーザー入力をサニタイズします
- `dangerouslySetInnerHTML` は控えめに、サニタイズされたコンテンツでのみ使用します

### データ保護

- データを危険にさらしたり、新たな脆弱性をもたらさないように、あらゆる段階で確認します
- 潜在的なセキュリティリスクがある場合は、追加のレビューを行います
- パスワードやAPIキーをハードコーディングしない

## 開発環境と運用

### Docker環境

- 開発時は`docker-compose.dev.yml`を使用
- フロントエンドポート: 5173
- バックエンドポート: 8080
- PostgreSQLポート: 5432

### API設計の共通原則

- RESTful APIパターンに従う
- 認証が必要なエンドポイントにはJWTミドルウェアを適用
- エラーレスポンスは一貫したJSON形式で返す
- API仕様書を常に最新の状態に保つ

### 運用上の考慮事項

- ソリューションのホスト、管理、監視、保守方法を考慮
- ログ出力戦略の実装
- ヘルスチェック機能の実装
- 適切なエラー追跡システムの導入

## テスト駆動開発の必須化

### テストファーストの原則

- 新機能の実装前には、まずテストケースを作成して期待する動作を定義します
- 既存コードの修正時は、修正前にテストケースで現在の動作を確認し、修正後もテストが通ることを確認します
- リファクタリング時は、既存のテストが全て通ることを保証してから行います

### テストカバレッジの要求

- 新規追加するすべての関数・コンポーネントにはテストを必須とします
- バグ修正時は、そのバグを再現するテストケースを作成してから修正します
- 重要なビジネスロジックには100%のテストカバレッジを目指します

## テストとQA - 品質保証

- エラーハンドリングは必ず含める
- 型安全性の確保（TypeScriptの厳密な型付け）
- Propsには必ず型定義を付ける
- API通信時の型定義を`types/index.ts`に集約

## 禁止事項（共通）

- `any`型の使用は最小限に抑制
- 未使用のimportやvariableを残さない
- console.logはデバッグ目的以外で使用しない
- パスワードやAPIキーをハードコーディングしない
- テストコードなしでの機能追加・修正は禁止
- Serena MCPを使用せずにCopilotでコード提案を行うことは禁止

## アクセシビリティ

- セマンティックなHTMLを使用
- 適切なARIA属性の実装
- キーボードナビゲーションのサポート
- スクリーンリーダーへの配慮

## コード生成時の共通推奨事項

- Copilotを使用する場合は、必ずSerena MCPを利用してプロジェクトの構造と規約を把握してからコード提案を行います
- コードを修正する場合は、既存のテストコードを必ず確認し、修正に合わせてテストも更新します
- テストコードが存在しない場合は、機能追加・修正と同時にテストコードを必ず追加します
- エラーハンドリングは必ず含める
- 機能の実装や修正を行った場合は、関連するドキュメント（特にREADME.md）も合わせて更新します
- **すべてのコメントとドキュメントは日本語で記述する**
