# GitHub Copilot Instructions for Simple Notion Project

## プロジェクト概要
Simple NotionはNotionクローンアプリケーションで、Go（バックエンド）とReact/TypeScript（フロントエンド）を使用して構築されています。ブロックベースのエディターと階層構造の文書管理機能を提供します。

## 技術スタック
- **バックエンド**: Go, PostgreSQL, Air（開発時ホットリロード）
- **フロントエンド**: React, TypeScript, Vite, Tailwind CSS, Radix UI
- **インフラ**: Docker, Docker Compose
- **テスト**: Vitest（フロントエンド）, Go標準テスト（バックエンド）

## 基本原則

### 開発とコミュニケーション
- 常に日本語で分かりやすい言葉を選び、丁寧な表現を心がけます
- 初心者にも分かりやすく説明します。専門用語はできるだけ避け、必要な場合は簡単な説明を加えます
- 常に励ましの言葉を添えます。学習意欲が高まる工夫をします
- 質問の意図が理解できない場合は、その旨を伝えます

### 開発ツールの使用方針
- Copilotを使用する場合は、必ずSerena MCPを利用してプロジェクトの構造と規約を把握してからコード提案を行います
- コードの分析、検索、編集にはSerena MCPの機能を活用し、プロジェクト全体の整合性を保ちます

### プログラミングパターン
- 関数型および宣言型のプログラミングパターンを使用し、クラスの使用は避けます
- コードの重複を避け、反復とモジュール化を優先します
- 補助動詞（`isLoading`、`hasError`など）を用いた説明的な変数名を使用します
- ROROパターン（Receive an Object, Return an Object）を必要に応じて使用します

### 開発プロセス
- 提案を行う際は、変更を個別のステップに分解し、各段階で小さなテストを提案して進行状況を確認します
- コードを書く前に、既存のコードを深くレビューし、動作を記述します
- ソリューションのホスト、管理、監視、保守方法を考慮し、運用上の懸念を強調します
- フィードバックに基づいてアプローチを調整し、提案がプロジェクトのニーズに合わせて進化するようにします

### セキュリティとデータ保護
- データを危険にさらしたり、新たな脆弱性をもたらさないように、あらゆる段階で確認します
- 潜在的なセキュリティリスクがある場合は、追加のレビューを行います

### 教育と支援
- コード例を示す際は、各行の目的を詳細なコメントで説明し、実行結果も示します
- 良いコーディングの習慣やベストプラクティスがあるなら、折りに触れアドバイスをします
- エラーメッセージは、エラーメッセージの意味を解説し、デバッグの手順を段階的に説明します
- 複雑な問題は、小さなステップに分割し一つずつ丁寧に解説します

## コーディング規約

### 全般的な原則
- 英語でのコメントとコード記述
- 明確で説明的な変数名・関数名を使用
- RESTful API設計に従う
- Clean Architectureパターンを採用

## バックエンドのコードスタイルと構造

### Go基本規約
- パッケージ名は小文字で記述
- ファイル名はsnake_caseで記述
- 公開関数/構造体はPascalCase、非公開はcamelCase
- エラーハンドリングでは適切なHTTPステータスコードとJSON形式のレスポンスを返す
- テーブル駆動テストを使用
- Clean Architectureパターンに従った設計

### プロジェクト構造
- `cmd/server/`: メインエントリーポイント
- `internal/handlers/`: HTTPハンドラー
- `internal/models/`: データモデル
- `internal/repository/`: データベースアクセス層
- `internal/middleware/`: ミドルウェア
- `migrations/`: データベースマイグレーション

### エラーハンドリング
- エラー処理とエッジケースを優先します
- エラー条件にはアーリーリターンを使用し、ガード句を実装して前提条件や無効な状態を早期に処理します
- 適切なエラーログとユーザーフレンドリーなエラーメッセージを実装します
- 予期しないエラーには適切なログ出力を実装します

## フォームとバリデーション

### 入力検証
- フロントエンド、バックエンド両方でバリデーションを実装
- 制御されたコンポーネントを使用したフォーム入力
- 適切なエラーメッセージの表示
- ユーザビリティを考慮した入力支援

### データの整合性
- スキーマ検証の実装
- 型安全性の確保
- サーバーサイドでの最終検証

## フロントエンドのコードスタイルと構造

### TypeScript/React基本規約
- 正確な例を用いて、簡潔で技術的なTypeScriptコードを記述します
- エクスポートされたコンポーネント、サブコンポーネント、ヘルパー、静的コンテンツ、型でファイルを構成します
- ディレクトリ名にはダッシュ付きの小文字を使用します（例：`components/auth-wizard`）
- コンポーネントは名前付きエクスポートを使用します。コンポーネント名にはケバブケースを使用します（例：`my-component.tsx`）
- 純粋な関数には `function` キーワードを使用します
- 単純なステートメントには簡潔な構文を使用します
- 宣言的なJSXを記述します
- 条件文では不要な中括弧を避け、1行文では中括弧を省略します
- セミコロンは省略します（ただし、文の曖昧さを避けるために必要な場合は使用します）
- 複雑なロジックには明確で簡潔なコメントを付けます
- 関数やコンポーネントにはJSDocコメントを使用し、IDEのインテリセンスを向上させます
- READMEファイルを常に最新の状態に保ちます

### ファイル構成とネーミング
- コンポーネント名はPascalCase（例: `DocumentEditor.tsx`）
- ユーティリティファイルはcamelCase（例: `utils.ts`）
- 関数コンポーネントを使用し、Hooksを活用
- Named Exportを推奨（default exportも併用可）
- インポート順序: 外部ライブラリ → 内部モジュール → 相対パス
- `@/`エイリアスを使用した絶対パス
- Tailwind CSSとRadix UIベースの共通コンポーネントを使用

### プロジェクト構造
- `src/components/`: Reactコンポーネント
- `src/stores/`: 状態管理
- `src/types/`: TypeScript型定義
- `src/tests/`: テストファイル

## UIとスタイリング

### デザインシステム
- コンポーネントとスタイリングには、Radix UI、Tailwind CSSを使用します
- Tailwind CSSでレスポンシブデザインを実装し、モバイルファーストのアプローチを採用します
- セマンティックなHTML要素を使用し、適切なARIA属性を実装し、キーボードナビゲーションをサポートします

### アクセシビリティ
- セマンティックなHTMLを使用
- 適切なARIA属性の実装
- キーボードナビゲーションのサポート
- スクリーンリーダーへの配慮

## 状態管理とデータフェッチ

### 状態管理戦略
- ローカル状態には `useState` を使用
- 複雑な状態ロジックには `useReducer` を検討
- グローバル状態が必要な場合は、ContextやZustandの使用を検討
- `use client`、`useEffect`、`useState`の使用を最小限にし、可能な限りサーバーサイドレンダリングの機能を優先します

### API通信
- fetch APIを使用したHTTP通信
- エラーハンドリングの適切な実装
- ローディング状態の管理
- データの型安全性を確保

### データベース規約
- テーブル名は複数形のsnake_case（例: `users`, `documents`, `blocks`）
- カラム名はsnake_case
- IDカラムは`id`、外部キーは`{table}_id`
- タイムスタンプは`created_at`, `updated_at`

## 開発時の注意事項

### Docker環境
- 開発時は`docker-compose.dev.yml`を使用
- フロントエンドポート: 5173
- バックエンドポート: 8080
- PostgreSQLポート: 5432

### API設計
- RESTful APIパターンに従う
- 認証が必要なエンドポイントにはJWTミドルウェアを適用
- エラーレスポンスは一貫したJSON形式で返す

## テストとQA

### フロントエンドテスト
- Testing Libraryを使用してユーザーの動作をテスト
- Vitestを使用した単体テスト
- 重要なユーザーフローには統合テストを実装
- テストファイルは`*.test.tsx`または`__tests__/*.tsx`

### バックエンドテスト
- テーブル駆動テストとモックを活用した単体テスト
- API統合テストの実装
- テストファイルは`*_test.go`
- モック使用時は適切な依存注入を実装

### 品質保証
- エラーハンドリングは必ず含める
- 型安全性の確保（TypeScriptの厳密な型付け）
- Propsには必ず型定義を付ける
- API通信時の型定義を`types/index.ts`に集約

## 開発プロセスと運用

### 開発環境管理
- 開発時は`docker-compose.dev.yml`を使用
- フロントエンドポート: 5173
- バックエンドポート: 8080
- PostgreSQLポート: 5432

### API設計とドキュメント
- RESTful APIパターンに従う
- 認証が必要なエンドポイントにはJWTミドルウェアを適用
- エラーレスポンスは一貫したJSON形式で返す
- API仕様書を常に最新の状態に保つ

### 運用上の考慮事項
- ソリューションのホスト、管理、監視、保守方法を考慮
- ログ出力戦略の実装
- ヘルスチェック機能の実装
- 適切なエラー追跡システムの導入

## セキュリティとデータ保護

### セキュリティ基本原則
- 認証トークンの適切な管理
- SQLインジェクション対策（プリペアドステートメント使用）
- XSS対策（適切なエスケープ処理）
- XSS攻撃を防ぐために、ユーザー入力をサニタイズします
- `dangerouslySetInnerHTML` は控えめに、サニタイズされたコンテンツでのみ使用します

### データ保護
- データを危険にさらしたり、新たな脆弱性をもたらさないように、あらゆる段階で確認します
- 潜在的なセキュリティリスクがある場合は、追加のレビューを行います
- パスワードやAPIキーをハードコーディングしない

## 最適化とパフォーマンス

### フロントエンド最適化
- React.memoやuseCallbackを適切に使用
- 大きなリストにはVirtualizationを検討
- クリティカルでないコンポーネントには動的ローディングを使用
- 画像は適切なフォーマットを使用し、サイズデータを含め、遅延ロードを実装

### バックエンド最適化
- データベースクエリは効率的に記述
- 適切なインデックスの使用
- N+1問題の回避
- キャッシュ戦略の実装

### 全般的な最適化
- グローバルスタイルの使用を最小限に抑え、モジュール化された、スコープされたスタイルを使用
- コード分割の実装
- バンドルサイズの最適化

## コード生成時の推奨事項
- Copilotを使用する場合は、必ずSerena MCPを利用してプロジェクトの構造と規約を把握してからコード提案を行います
- コードを修正する場合は、既存のテストコードを必ず確認し、修正に合わせてテストも更新します
- テストコードが存在しない場合は、機能追加・修正と同時にテストコードを必ず追加します
- 新しいコンポーネント作成時は型定義とテストファイルも同時に生成
- APIハンドラー作成時は対応するテストケースも含める
- データベースマイグレーション追加時は適切なロールバック処理も記述
- エラーハンドリングは必ず含める
- コメントは複雑なロジックに対してのみ追加（日本語可）

## テスト駆動開発の必須化

### テストファーストの原則
- 新機能の実装前には、まずテストケースを作成して期待する動作を定義します
- 既存コードの修正時は、修正前にテストケースで現在の動作を確認し、修正後もテストが通ることを確認します
- リファクタリング時は、既存のテストが全て通ることを保証してから行います

### テストカバレッジの要求
- 新規追加するすべての関数・コンポーネントにはテストを必須とします
- バグ修正時は、そのバグを再現するテストケースを作成してから修正します
- 重要なビジネスロジックには100%のテストカバレッジを目指します

## 禁止事項
- `any`型の使用は最小限に抑制
- 未使用のimportやvariableを残さない
- console.logはデバッグ目的以外で使用しない
- パスワードやAPIキーをハードコーディングしない
- テストコードなしでの機能追加・修正は禁止
- Serena MCPを使用せずにCopilotでコード提案を行うことは禁止

## ファイルパターン
- React コンポーネント: `src/components/{ComponentName}.tsx`
- React テスト: `src/components/__tests__/{ComponentName}.test.tsx`
- 型定義: `src/types/index.ts`
- Goハンドラー: `internal/handlers/{feature}.go`
- Goテスト: `internal/handlers/{feature}_test.go`
- Goモデル: `internal/models/{model}.go`
- SQLマイグレーション: `migrations/{number}_{description}.sql`
