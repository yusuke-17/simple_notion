# 共通開発規約

> このファイルはバックエンドとフロントエンドの両方に共通するルールを定義しています。

## 基本原則

### プログラミングパターン

- **関数型および宣言型のプログラミング**: クラスの使用は避け、関数型パターンを優先
- **コードの重複を避ける**: 反復とモジュール化を優先
- **説明的な変数名**: 補助動詞（`isLoading`、`hasError`など）を用いた明確な命名
- **ROROパターン**: Receive an Object, Return an Object（必要に応じて）

### 開発プロセス

- **段階的な実装**: 変更を個別のステップに分解し、各段階で小さなテストを実施
- **既存コードの深いレビュー**: コードを書く前に、既存のコードを深く理解
- **運用を考慮した設計**: ホスト、管理、監視、保守方法を考慮
- **フィードバック駆動**: フィードバックに基づいてアプローチを調整

## コーディング規約

### 全般的な原則

- **コメントとドキュメント**: すべて日本語で記述
- **変数・関数名**: 明確で説明的な名前を使用（英語）
- **RESTful API設計**: REST原則に従う
- **Clean Architecture**: レイヤー責務を明確に分離
- **SOLID原則**: 単一責任、開放閉鎖、リスコフ置換、インターフェース分離、依存性逆転

## セキュリティとデータ保護

### セキュリティ基本原則

- **認証トークンの適切な管理**: JWTの適切な保存と送信
- **SQLインジェクション対策**: プリペアドステートメントの使用必須
- **XSS対策**: 適切なエスケープ処理とサニタイゼーション
- **パスワード/APIキーの保護**: ハードコーディング禁止、環境変数を使用

### データ保護

- **脆弱性の早期発見**: あらゆる段階でセキュリティリスクを確認
- **追加レビューの実施**: 潜在的なリスクがある場合は追加確認
- **センシティブ情報の管理**: ログに機密情報を出力しない

## フォームとバリデーション

### 入力検証

- **二重バリデーション**: フロントエンド・バックエンド両方で実装
- **適切なエラーメッセージ**: ユーザーフレンドリーなメッセージ表示
- **入力支援**: ユーザビリティを考慮した入力補助

### データの整合性

- **スキーマ検証**: 厳密なスキーマ定義と検証
- **型安全性の確保**: TypeScript/Go型システムを最大限活用
- **サーバーサイド最終検証**: 必ずバックエンドで最終確認

## テスト駆動開発（TDD）の必須化

### テストファーストの原則

- **新機能実装前**: まずテストケースを作成して期待する動作を定義
- **既存コード修正時**: 修正前にテストケースで現在の動作を確認
- **リファクタリング時**: 既存のテストが全て通ることを保証してから実施

### テストカバレッジの要求

- **新規関数・コンポーネント**: テストを必須とする
- **バグ修正時**: そのバグを再現するテストケースを作成してから修正
- **重要なビジネスロジック**: 100%のテストカバレッジを目指す

### テストのベストプラクティス

- **エラーハンドリングのテスト**: 正常系だけでなく異常系も必ずテスト
- **型安全性の確保**: TypeScript strict mode使用
- **Props/引数の型定義**: 必ず型定義を付ける
- **API通信の型定義**: `types/index.ts`に集約

## 開発環境と運用

### Docker環境

- **開発時**: `docker-compose.dev.yml`を使用
- **フロントエンドポート**: 5173
- **バックエンドポート**: 8080
- **PostgreSQLポート**: 5432

### API設計の共通原則

- **RESTful APIパターン**: GET/POST/PUT/PATCH/DELETEの適切な使用
- **認証**: JWTミドルウェアを適用
- **エラーレスポンス**: 一貫したJSON形式

```json
{
  "error": "Error Type",
  "message": "ユーザーフレンドリーなメッセージ"
}
```

- **HTTPステータスコード**:
  - `200 OK`: 成功（GET, PUT, PATCH）
  - `201 Created`: リソース作成成功（POST）
  - `204 No Content`: 成功でボディなし（DELETE）
  - `400 Bad Request`: バリデーションエラー
  - `401 Unauthorized`: 認証失敗
  - `403 Forbidden`: 権限不足
  - `404 Not Found`: リソースが存在しない
  - `500 Internal Server Error`: サーバー内部エラー

### 運用上の考慮事項

- **ログ出力戦略**: 適切なログレベル（DEBUG/INFO/WARN/ERROR）
- **ヘルスチェック機能**: `/health`エンドポイントの実装
- **エラー追跡**: 適切なエラートラッキングシステムの導入

## 禁止事項（共通）

- ❌ `any`型の過度な使用（最小限に抑制）
- ❌ 未使用のimport/variableを残す
- ❌ `console.log`をデバッグ目的以外で使用
- ❌ パスワード/APIキーのハードコーディング
- ❌ テストコードなしでの機能追加・修正
- ❌ エラーの無視（`err`を`_`で捨てる、try-catchなし）

## アクセシビリティ

- **セマンティックなHTML**: `<button>`, `<nav>`, `<main>`等を適切に使用
- **ARIA属性**: 必要に応じて`aria-label`, `aria-describedby`等を実装
- **キーボードナビゲーション**: Tab/Enter/Escapeキーのサポート
- **スクリーンリーダー配慮**: 視覚障害者にも使いやすいUI

## コード生成時の共通推奨事項

1. **テストコードの確認と更新**: コード修正時は既存テストを確認し、必要に応じて更新
2. **テストコードが存在しない場合**: 機能追加・修正と同時に必ず追加
3. **エラーハンドリング**: 必ず含める
4. **ドキュメント更新**: 機能実装・修正時は関連ドキュメント（特にREADME.md）も更新
5. **コメント**: すべて日本語で記述
6. **説明責任**: なぜそのアプローチを選択したのか説明

## パフォーマンス最適化

### 一般的な最適化

- **N+1問題の回避**: データベースクエリ・API呼び出しを最適化
- **適切なキャッシュ戦略**: 頻繁にアクセスされるデータのキャッシュ
- **遅延ロード**: 必要になるまでリソースの読み込みを遅延
- **コード分割**: 大きなバンドルを小さなチャンクに分割

### モニタリング

- **パフォーマンス計測**: 定期的なプロファイリング
- **メトリクス収集**: レスポンスタイム、エラー率等の監視
- **ボトルネックの特定**: 問題箇所の早期発見と改善
