# Development Dockerfile for Svelte 5 + Vite

FROM node:24-alpine

# セキュリティアップデートを適用
RUN apk upgrade --no-cache

# セキュリティ向上のためnon-rootユーザーを作成
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nodejs -u 1001

WORKDIR /app

# Enable corepack and pnpm
RUN corepack enable
RUN corepack prepare pnpm@latest --activate

# ディレクトリの所有者を変更
RUN chown -R nodejs:nodejs /app

# non-rootユーザーに切り替え
USER nodejs

# Copy package files (pnpm uses package.json and pnpm-lock.yaml)
COPY --chown=nodejs:nodejs package.json pnpm-lock.yaml* ./

# Install dependencies with pnpm
RUN pnpm install --frozen-lockfile

# Copy source code
COPY --chown=nodejs:nodejs . .

# Expose port 5174 for Vite dev server (Svelte version)
EXPOSE 5174

# Start development server
CMD ["pnpm", "dev", "--", "--host", "0.0.0.0", "--port", "5174"]
